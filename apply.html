<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Your Video Application - Introvy.ai</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fas fa-video text-2xl text-blue-600 mr-2"></i>
                    <span class="text-xl font-bold text-gray-800">Introvy.ai</span>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="planBadge" class="bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-sm">
                        <i class="fas fa-user mr-1"></i>Free Plan
                    </span>
                    <div id="authButtons" class="space-x-2">
                        <button id="loginBtn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">Login</button>
                        <button id="signupBtn" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">Sign Up</button>
                    </div>
                    <div id="userMenu" class="hidden space-x-2">
                        <span id="userName" class="text-gray-700 font-medium"></span>
                        <button id="logoutBtn" class="text-gray-600 hover:text-gray-800">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Auth Required Message -->
    <div id="authRequired" class="container mx-auto px-6 py-8">
        <div class="max-w-2xl mx-auto text-center">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-8">
                <i class="fas fa-lock text-4xl text-blue-600 mb-4"></i>
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Authentication Required</h2>
                <p class="text-gray-600 mb-6">Please log in or create an account to continue.</p>
                <div class="space-x-4">
                    <button id="authLoginBtn" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700">Log In</button>
                    <button id="authSignupBtn" class="bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-gray-700">Sign Up</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainApp" class="hidden container mx-auto px-6 py-8">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-lg p-8">
                <h2 class="text-2xl font-bold mb-6">Tell us about the job you're applying for</h2>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Your Name *</label>
                        <input type="text" id="candidateName" required class="w-full p-3 border border-gray-300 rounded-lg" placeholder="Enter your full name">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Job Title *</label>
                            <input type="text" id="jobTitle" required class="w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g. Software Engineer">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Company Name *</label>
                            <input type="text" id="companyName" required class="w-full p-3 border border-gray-300 rounded-lg" placeholder="e.g. Google">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Job Description *</label>
                        <textarea id="jobDescription" required rows="6" class="w-full p-3 border border-gray-300 rounded-lg" placeholder="Paste the full job description here..."></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Question Difficulty</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="block p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="difficulty" value="easy" checked class="sr-only">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium">Easy</div>
                                        <div class="text-sm text-gray-600">Basic questions about candidate background</div>
                                    </div>
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-xs">Free</span>
                                </div>
                            </label>
                            <label class="block p-4 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50">
                                <input type="radio" name="difficulty" value="challenging" class="sr-only">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium">Challenging</div>
                                        <div class="text-sm text-gray-600">Harder questions that help you stand out</div>
                                    </div>
                                    <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded text-xs">Pro Plan</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <button id="generateBtn" class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700">
                            Generate AI Questions
                            <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Questions Display -->
                <div id="questionsSection" class="hidden mt-8">
                    <h3 class="text-xl font-bold mb-4">Your Interview Questions</h3>
                    <div id="questionsContainer" class="space-y-4">
                        <!-- Questions will appear here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg w-96">
            <h3 class="text-xl font-bold mb-4">Log In</h3>
            <div class="space-y-4">
                <input type="email" id="loginEmail" placeholder="Email" class="w-full p-3 border rounded-lg">
                <input type="password" id="loginPassword" placeholder="Password" class="w-full p-3 border rounded-lg">
                <div id="loginError" class="text-red-600 text-sm hidden"></div>
                <div class="flex space-x-4">
                    <button id="loginCancelBtn" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg">Cancel</button>
                    <button id="loginSubmitBtn" class="flex-1 bg-blue-600 text-white py-2 rounded-lg">Log In</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Simple Signup Modal -->
    <div id="signupModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg w-96">
            <h3 class="text-xl font-bold mb-4">Create Account</h3>
            <div class="space-y-4">
                <input type="text" id="signupName" placeholder="Full Name" class="w-full p-3 border rounded-lg">
                <input type="email" id="signupEmail" placeholder="Email" class="w-full p-3 border rounded-lg">
                <input type="password" id="signupPassword" placeholder="Password (8+ characters)" class="w-full p-3 border rounded-lg">
                <div id="signupError" class="text-red-600 text-sm hidden"></div>
                <div class="flex space-x-4">
                    <button id="signupCancelBtn" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg">Cancel</button>
                    <button id="signupSubmitBtn" class="flex-1 bg-blue-600 text-white py-2 rounded-lg">Create Account</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Modal -->
    <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"></div>
            <p id="loadingText">Loading...</p>
        </div>
    </div>

    <script>
        // Simple global variables
        let currentUser = null;
        let authToken = null;
        let userPlan = 'free';

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded, initializing...');
            
            // Check if already logged in
            const savedToken = localStorage.getItem('authToken');
            const savedUser = localStorage.getItem('currentUser');
            
            if (savedToken && savedUser) {
                try {
                    authToken = savedToken;
                    currentUser = JSON.parse(savedUser);
                    userPlan = currentUser.plan || 'free';
                    showMainApp();
                } catch (error) {
                    console.error('Error loading saved user:', error);
                    showAuthRequired();
                }
            } else {
                showAuthRequired();
            }

            // Add event listeners
            setupEventListeners();
        });

        function setupEventListeners() {
            // Login buttons
            document.getElementById('loginBtn').addEventListener('click', openLoginModal);
            document.getElementById('authLoginBtn').addEventListener('click', openLoginModal);
            document.getElementById('loginCancelBtn').addEventListener('click', closeLoginModal);
            document.getElementById('loginSubmitBtn').addEventListener('click', processLogin);

            // Signup buttons
            document.getElementById('signupBtn').addEventListener('click', openSignupModal);
            document.getElementById('authSignupBtn').addEventListener('click', openSignupModal);
            document.getElementById('signupCancelBtn').addEventListener('click', closeSignupModal);
            document.getElementById('signupSubmitBtn').addEventListener('click', processSignup);

            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', logout);

            // Generate questions button
            document.getElementById('generateBtn').addEventListener('click', generateQuestions);

            console.log('Event listeners added');
        }

        function openLoginModal() {
            console.log('Opening login modal...');
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('loginEmail').focus();
        }

        function closeLoginModal() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('loginError').classList.add('hidden');
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        function openSignupModal() {
            console.log('Opening signup modal...');
            document.getElementById('signupModal').classList.remove('hidden');
            document.getElementById('signupName').focus();
        }

        function closeSignupModal() {
            document.getElementById('signupModal').classList.add('hidden');
            document.getElementById('signupError').classList.add('hidden');
            document.getElementById('signupName').value = '';
            document.getElementById('signupEmail').value = '';
            document.getElementById('signupPassword').value = '';
        }

        async function processLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!email || !password) {
                showError('loginError', 'Please enter both email and password.');
                return;
            }

            showLoading('Logging in...');

            try {
                const response = await fetch('https://introvy-backend.vercel.app/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                hideLoading();

                if (data.success) {
                    authToken = data.token;
                    currentUser = data.user;
                    userPlan = data.user.plan || 'free';
                    
                    localStorage.setItem('authToken', data.token);
                    localStorage.setItem('currentUser', JSON.stringify(data.user));
                    
                    closeLoginModal();
                    showMainApp();
                    
                    if (currentUser.name) {
                        document.getElementById('candidateName').value = currentUser.name;
                    }
                } else {
                    showError('loginError', data.error || 'Login failed');
                }
            } catch (error) {
                hideLoading();
                console.error('Login error:', error);
                showError('loginError', 'Network error. Please try again.');
            }
        }

        async function processSignup() {
            const name = document.getElementById('signupName').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const password = document.getElementById('signupPassword').value;
            
            if (!name || !email || !password) {
                showError('signupError', 'Please fill in all fields.');
                return;
            }

            if (password.length < 8) {
                showError('signupError', 'Password must be at least 8 characters.');
                return;
            }

            showLoading('Creating account...');

            try {
                const response = await fetch('https://introvy-backend.vercel.app/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });

                const data = await response.json();
                hideLoading();

                if (data.success) {
                    closeSignupModal();
                    alert('Account created! Logging you in...');
                    
                    // Auto-login
                    document.getElementById('loginEmail').value = email;
                    document.getElementById('loginPassword').value = password;
                    processLogin();
                } else {
                    showError('signupError', data.error || 'Registration failed');
                }
            } catch (error) {
                hideLoading();
                console.error('Signup error:', error);
                showError('signupError', 'Network error. Please try again.');
            }
        }

        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentUser');
            authToken = null;
            currentUser = null;
            userPlan = 'free';
            
            showAuthRequired();
        }

        function showMainApp() {
            document.getElementById('authRequired').style.display = 'none';
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('authButtons').classList.add('hidden');
            document.getElementById('userMenu').classList.remove('hidden');
            
            document.getElementById('userName').textContent = currentUser.name;
            
            const planBadge = document.getElementById('planBadge');
            if (userPlan === 'pro') {
                planBadge.innerHTML = '<i class="fas fa-crown mr-1"></i>Pro Plan';
                planBadge.className = 'bg-purple-100 text-purple-700 px-3 py-1 rounded-full text-sm';
            }
        }

        function showAuthRequired() {
            document.getElementById('authRequired').style.display = 'block';
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('authButtons').classList.remove('hidden');
            document.getElementById('userMenu').classList.add('hidden');
        }

        async function generateQuestions() {
            if (!authToken) {
                alert('Please log in first');
                openLoginModal();
                return;
            }

            const jobTitle = document.getElementById('jobTitle').value;
            const companyName = document.getElementById('companyName').value;
            const jobDescription = document.getElementById('jobDescription').value;
            const difficulty = document.querySelector('input[name="difficulty"]:checked').value;

            if (!jobTitle || !companyName || !jobDescription) {
                alert('Please fill in all required fields.');
                return;
            }

            if (userPlan === 'free' && difficulty === 'challenging') {
                alert('Challenging questions require Pro plan ($9/month). Please upgrade or select Easy difficulty.');
                return;
            }

            showLoading('Generating questions...');

            try {
                const response = await fetch('https://introvy-backend.vercel.app/api/ai/generate-questions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + authToken
                    },
                    body: JSON.stringify({
                        jobDescription,
                        difficulty,
                        questionCount: 3,
                        userId: currentUser.id,
                        userPlan,
                        isRegeneration: false
                    })
                });

                const data = await response.json();
                hideLoading();

                if (data.success) {
                    displayQuestions(data.questions);
                } else {
                    alert('Error: ' + (data.error || 'Failed to generate questions'));
                }
            } catch (error) {
                hideLoading();
                console.error('Error:', error);
                alert('Failed to generate questions. Please try again.');
            }
        }

        function displayQuestions(questions) {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = questions.map((q, index) => `
                <div class="bg-gray-50 p-4 rounded-lg">
                    <div class="font-medium">Question ${index + 1}</div>
                    <div class="mt-2">${q.question}</div>
                </div>
            `).join('');
            
            document.getElementById('questionsSection').classList.remove('hidden');
        }

        function showError(elementId, message) {
            const errorDiv = document.getElementById(elementId);
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
        }

        function showLoading(text) {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingModal').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loadingModal').classList.add('hidden');
        }
    </script>
</body>
</html>
